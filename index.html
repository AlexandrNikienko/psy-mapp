<!DOCTYPE html>
<html>
<head>
    <title>PsyMap Application</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="UTF-8">
    <meta name="description" content="Psytrance festivals map">

    <meta property="og:title" content="PsyMap Application"/>
    <meta property="og:site_name" content="Psytrance festivals map"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="http://moonkoradji.com/psymap/images/psymap-bg.jpg"/>
    <meta property="og:url" content="http://moonkoradji.com/psymap/"/>
    <meta property="og:description" content="Psytrance festivals map"/>
    <meta property="fb:admins" content=""/>


    <link rel="shortcut icon" href="images/favicon.png">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="styles/styles.css">

    <script type="application/ld+json">
      {
      "@context" : "http://schema.org",
      "@type" : "Application",
      "name" : "PsyMap",
      "url" : "http://www.moonkoradji.com/psymap/",
      "sameAs" : [ "https://www.facebook.com/psymaptest/"],
      "logo": "http://moonkoradji.com/psymap/images/psy-map-logo.png",
      "image": "http://moonkoradji.com/psymap/images/psymap-bg.jpg",
      "description": "Psytrance festivals map"
      }
    </script>

</head>
<body>
<script>
    // This is called with the results from from FB.getLoginStatus().
    function statusChangeCallback(response) {
        console.log('statusChangeCallback');
        console.log(response);
        // The response object is returned with a status field that lets the
        // app know the current login status of the person.
        // Full docs on the response object can be found in the documentation
        // for FB.getLoginStatus().
        if (response.status === 'connected') {
            // Logged into your app and Facebook.
            // Here we run a Graph API after login is successful.
            // See statusChangeCallback() for when this call is made.
            var uid = response.authResponse.userID;
            psyMappAPI(uid);
            $(".fb-page, .welcome, .date-range").show();
            $(".login").addClass("hide");
        } else if (response.status === 'not_authorized') {
            // The person is logged into Facebook, but not your app.
            console.log("The person is logged into Facebook, but not your app.");
            //document.getElementById('status').innerHTML = 'Please log into this app.';
        } else {
            // The person is not logged into Facebook, so we're not sure if
            // they are logged into this app or not.
            console.log("The person is not logged into Facebook.");
            //document.getElementById('status').innerHTML = 'Please log into Facebook.';
        }
    }
    // This function is called when someone finishes with the Login
    // Button.  See the onlogin handler attached to it in the sample
    // code below.
    function checkLoginState() {
        FB.getLoginStatus(function (response) {
            statusChangeCallback(response);
        });
    }

    window.fbAsyncInit = function () {
        FB.init({
            appId: '694984177343686',
            cookie: true,  // enable cookies to allow the server to access
                           // the session
            xfbml: true,  // parse social plugins on this page
            version: 'v2.8' // use graph api version 2.8
        });
        // Now that we've initialized the JavaScript SDK, we call
        // FB.getLoginStatus().  This function gets the state of the
        // person visiting this page and can return one of three states to
        // the callback you provide.  They can be:
        //
        // 1. Logged into your app ('connected')
        // 2. Logged into Facebook, but not your app ('not_authorized')
        // 3. Not logged into Facebook and can't tell if they are logged into
        //    your app or not.
        //
        // These three cases are handled in the callback function.
        FB.getLoginStatus(function (response) {
            statusChangeCallback(response);
        });
    };

    // Load the SDK asynchronously
    (function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s);
        js.id = id;
        js.src = "//connect.facebook.net/en_US/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));

</script>



<main class="main-wrapper">
    <div id="map"></div>

    <!--Below we include the Login Button social plugin. This button uses
  the JavaScript SDK to present a graphical Login button that triggers
  the FB.login() function when clicked.-->
    <div class="login">
        <div class="logo"></div>
        <div class="title-main">PsyMap</div>
        <div class="title-second">application</div>
        <fb:login-button scope="public_profile,email" onlogin="checkLoginState();"></fb:login-button>

        <div id="status"></div>
        <div id="results"></div>
    </div>

    <div class="welcome"></div>

    <div class="fb-page"
         data-href="https://www.facebook.com/psymaptest/"
         data-tabs="messages"
         data-height="400"
         data-width="222"
         data-small-header="false"
         data-adapt-container-width="true"
         data-hide-cover="false"
         data-show-facepile="true">
        <blockquote cite="https://www.facebook.com/psymaptest/" class="fb-xfbml-parse-ignore">
            <a href="https://www.facebook.com/psymaptest/">PsyMap</a>
        </blockquote>
    </div>

    <div class="date-range">
        <label for="from">date from</label>
        <input type="text" id="from" name="from">
        <label for="to">date to</label>
        <input type="text" id="to" name="to">
        <span class="reset-btn js-reset-filter">reset</span>
    </div>

    <div class="sheep-1"></div>

    <footer class="footer">
        &copy; PsyMap Application 2017
    </footer>
</main>


<script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
<script
        src="http://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
        integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="
        crossorigin="anonymous"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAuDBQMQJlNaUl_ZThZZe9V99nsCnJRQTc&language=en&callback=initMap"></script>
<script src="scripts/psy-mapp.js"></script>

<script type="text/javascript">
    function psyMappAPI(UID) {
        psyMapp.init();
        psyMapp.getUser(UID);
    }

    if (psyMapp.isLocal()) {
        psyMapp.init();
        $(".date-range").show();
    }


    /* filters */
    $(function () {
        var dateFormat = "mm/dd/yy",
            from = $("#from")
                .datepicker({
                    defaultDate: "+1w",
                    changeMonth: true,
                    numberOfMonths: 1,
                    minDate: new Date()
                })
                .on("change", function () {
                    to.datepicker("option", "minDate", getDate(this));
                    console.info("reset markers from ", getDate(this));
                    psyMapp.filterDateFrom = new Date(getDate(this));
                    psyMapp.initGoogleMap();
                    psyMapp.showMarkers();
                }),
            to = $("#to").datepicker({
                defaultDate: "+1w",
                changeMonth: true,
                numberOfMonths: 1,
                minDate: new Date()
            })
                .on("change", function () {
                    from.datepicker("option", "maxDate", getDate(this));
                    console.info("reset markers to ", getDate(this));
                    psyMapp.filterDateTo = new Date(getDate(this));
                    psyMapp.initGoogleMap();
                    psyMapp.showMarkers();
                });

        function getDate(element) {
            var date;
            try {
                date = $.datepicker.parseDate(dateFormat, element.value);
            } catch (error) {
                date = null;
            }
            return date;
        }

        $('.js-reset-filter').on('click', function(){
            var date = new Date(),
                year = date.getFullYear();

            psyMapp.filterDateFrom = new Date('' + year + '-01-01');
            psyMapp.filterDateTo = new Date('' + year + '-12-31');

            psyMapp.initGoogleMap();
            psyMapp.showMarkers();

            $("#from, #to").datepicker( "option" , {
                minDate: null,
                maxDate: null,
                minDate: new Date()} ).datepicker('setDate', null);
        });
    });
</script>

<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-68571504-2', 'auto');
    ga('send', 'pageview');

</script>

</body>
</html>